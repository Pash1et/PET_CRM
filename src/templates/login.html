{% extends "base.html" %}

{% block content %}
<div class="login-container">
    <div class="login-card">
        <h1 class="login-title">Вход в CRM</h1>
        <form id="login-form">
            <div class="form-group">
                <label for="email">Email</label>
                <input type="email" id="email" name="email" required
                       style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 6px; font-size: 14px;">
            </div>
            <div class="form-group">
                <label for="password">Пароль</label>
                <input type="password" id="password" name="password" required
                       style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 6px; font-size: 14px;">
            </div>
            <button type="submit"
                    style="width: 100%; padding: 12px; background: #4CAF50; color: white; border: none; border-radius: 6px; font-size: 16px; cursor: pointer;">
                Войти
            </button>
        </form>
        <div id="error-message" class="error" style="display: none; color: #d32f2f; font-size: 14px; text-align: center; margin-top: 16px;"></div>
    </div>
</div>

<style>
    .login-container {
        display: flex;
        justify-content: center;
        align-items: center;
        min-height: 100vh;
        padding: 40px 20px;
        background: #f6f6f6;
    }

    .login-card {
        background: white;
        padding: 32px;
        border-radius: 12px;
        box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        width: 100%;
        max-width: 400px;
    }

    .login-title {
        font-size: 24px;
        font-weight: 600;
        color: #333;
        margin-bottom: 24px;
        text-align: center;
    }

    .form-group {
        margin-bottom: 16px;
    }

    .error {
        color: #d32f2f;
        font-size: 14px;
        text-align: center;
        margin-top: 16px;
    }
</style>
{% endblock %}

{% block scripts %}
<script>
    document.getElementById("login-form").onsubmit = async (e) => {
        e.preventDefault();
        const formData = new FormData(e.target);
        const data = Object.fromEntries(formData);

        try {
            const response = await fetch("/api/v1/auth/login", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json"
                },
                body: JSON.stringify(data)
            });

            if (response.ok) {
                window.location.href = "/ui";
            } else {
                const error = await response.json();
                const errorEl = document.getElementById("error-message");
                errorEl.textContent = error.detail || "Неверный email или пароль";
                errorEl.style.display = "block";
            }
        } catch (err) {
            document.getElementById("error-message").textContent = "Ошибка сети";
            document.getElementById("error-message").style.display = "block";
        }
    };
</script>
{% endblock %}
